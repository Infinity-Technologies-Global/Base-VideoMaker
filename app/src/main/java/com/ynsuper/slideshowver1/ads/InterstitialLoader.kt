package com.ynsuper.slideshowver1.adsimport android.content.Contextimport androidx.appcompat.app.AlertDialogimport com.facebook.ads.Adimport com.facebook.ads.AdErrorimport com.facebook.ads.InterstitialAdListenerimport com.google.android.gms.ads.AdListenerimport com.google.android.gms.ads.AdRequestimport com.google.android.gms.ads.InterstitialAdimport com.ynsuper.slideshowver1.Rimport com.ynsuper.slideshowver1.remoteconfig.RemoteConfigAppimport timber.log.Timberclass InterstitialLoader {    lateinit var mContext: Context    var googleId: String? = ""    var facebookId: String? = ""    private var mAdCloseListener: AdCloseListener? = null    var progressDialog: AlertDialog? = null    private lateinit var mInterstitialAdFacebook: com.facebook.ads.InterstitialAd    private lateinit var mInterstitialAdGoogle: InterstitialAd    fun setAdsId(context: Context, googleAdsId: String, fanAdsId: String) {        mContext = context        googleId = googleAdsId        facebookId = fanAdsId        initUi()    }    private fun initUi() {        progressDialog = AlertDialog.Builder(mContext)                .setView(R.layout.dialog_loading_ads)                .setCancelable(false)                .create()    }//    fun showInterstitial(adCloseListener: AdCloseListener) {//        mAdCloseListener = adCloseListener//        progressDialog?.show()//        loadAdsInterstitialFacebook()////        loadAdsInterstitialGoogle()////        progressDialog?.setOnCancelListener {////            mAdCloseListener?.onAdClosed()////        }//    }    fun showInterstitial(adCloseListener: AdCloseListener, isShowDialog: Boolean) {        mAdCloseListener = adCloseListener        if (isShowDialog) {            progressDialog?.show()        }        if (UtilAd.checkShowFacebookAds(mContext) && RemoteConfigApp.show_intersitial_facebook) {            loadAdsInterstitialFacebook()        } else {            loadAdsInterstitialGoogle()        }//        progressDialog?.setOnCancelListener {//            mAdCloseListener?.onAdClosed()//        }    }    private fun loadAdsInterstitialFacebook() {        mInterstitialAdFacebook =                com.facebook.ads.InterstitialAd(mContext, facebookId)        val adListener = object : InterstitialAdListener {            override fun onInterstitialDisplayed(p0: Ad?) {                Timber.d("onInterstitialDisplayed")            }            override fun onAdClicked(p0: Ad?) {                Timber.d("onAdClicked")            }            override fun onInterstitialDismissed(p0: Ad?) {                Timber.d("onInterstitialDismissed")                if (progressDialog != null) {                    progressDialog?.dismiss()                }                if (mAdCloseListener != null) {                    mAdCloseListener?.onAdClosed()                }            }            override fun onError(ad: Ad?, adError: AdError?) {                Timber.d("Interstitial ad failed to load: %s", adError?.errorMessage)                loadAdsInterstitialGoogle()            }            override fun onAdLoaded(p0: Ad?) {                Timber.d("onAdLoaded: FAN")                progressDialog?.dismiss()                if (mInterstitialAdFacebook.isAdLoaded && mInterstitialAdFacebook.isAdInvalidated.not()) {                    mInterstitialAdFacebook.show()                } else {                    mAdCloseListener?.onAdClosed()                }            }            override fun onLoggingImpression(p0: Ad?) {                Timber.d("onLoggingImpression")            }        }        val loadAdConfig = mInterstitialAdFacebook.buildLoadAdConfig()                .withAdListener(adListener)                .build()        mInterstitialAdFacebook.loadAd(loadAdConfig)    }    private fun loadAdsInterstitialGoogle() {        mInterstitialAdGoogle = InterstitialAd(mContext)        mInterstitialAdGoogle.adUnitId = googleId        val adRequestBuilder = AdRequest.Builder()        mInterstitialAdGoogle.adListener = object : AdListener() {            override fun onAdLoaded() {                Timber.d("onAdLoaded admob")                if (mInterstitialAdGoogle.isLoaded) {                    mInterstitialAdGoogle.show()                }                progressDialog?.dismiss()                mAdCloseListener?.onAdClosed()            }            override fun onAdFailedToLoad(errorCode: Int) {                Timber.d("""onAdFailedToLoad admob:$errorCode""")                progressDialog?.dismiss()                mAdCloseListener?.onAdClosed()            }            override fun onAdOpened() {                Timber.d("onAdOpened")                // Code to be executed when the ad is displayed.                progressDialog?.dismiss()                mAdCloseListener?.onAdClosed()            }            override fun onAdClicked() {//                Timber.d("onAdClicked")                // Code to be executed when the user clicks on an ad.            }            override fun onAdLeftApplication() {                Timber.d("onAdLeftApplication")                mAdCloseListener?.onAdClosed()            }            override fun onAdClosed() {                Timber.d("onAdClosed")                progressDialog?.dismiss()                mAdCloseListener?.onAdClosed()            }        }        mInterstitialAdGoogle.loadAd(adRequestBuilder.build())    }    interface AdCloseListener {        fun onAdClosed()    }}